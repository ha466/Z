<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Ambulance Bill (Half A4)</title>
    <!-- Tailwind CSS for layout and UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2pdf library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* Custom styles for the Half A4 (A5 Landscape) print format */
        body {
            background-color: #f3f4f6;
            font-family: Arial, sans-serif;
        }

        .half-a4-paper {
            width: 210mm;
            min-height: 148.5mm; /* Exactly half the height of an A4 sheet */
            background: white;
            margin: 20px auto;
            padding: 10mm 15mm; /* Slightly tighter padding to fit the half sheet */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        /* Editable fields styling */
        [contenteditable="true"] {
            outline: none;
            border-bottom: 1px dashed transparent;
            transition: all 0.2s;
            display: inline-block;
            min-width: 20px;
        }

        [contenteditable="true"]:hover, [contenteditable="true"]:focus {
            background-color: #fef08a; /* light yellow */
            border-bottom: 1px dashed #ca8a04;
        }

        /* Table styles to match the image */
        .bill-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        .bill-table th, .bill-table td {
            border: 1px solid #000;
            padding: 6px;
            vertical-align: top;
        }
        
        /* Make Particulars column wide */
        .bill-table th:nth-child(2), .bill-table td:nth-child(2) {
            width: 70%;
        }

        /* Make S.No and Amount columns fixed width */
        .bill-table th:nth-child(1), .bill-table td:nth-child(1) {
            width: 10%;
            text-align: center;
        }

        .bill-table th:nth-child(3), .bill-table td:nth-child(3) {
            width: 20%;
            text-align: right;
        }

        /* Adjusted height for half page */
        .main-row td {
            height: 120px; /* Reduced from 250px so it fits nicely on a half page */
            position: relative;
        }

        /* Hide UI elements during print/pdf generation */
        .no-print {
            display: flex;
        }

        /* Ensure size looks good on mobile screens too */
        @media (max-width: 800px) {
            .half-a4-paper {
                width: 100%;
                margin: 0;
                padding: 10px;
                min-height: auto;
            }
        }
        
        /* When generating PDF, ensure styles are pristine */
        .pdf-mode [contenteditable="true"] {
            border-bottom: none !important;
            background-color: transparent !important;
        }
        .pdf-mode .no-print {
            display: none !important;
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex flex-col items-center">

    <!-- Action Bar -->
    <div class="no-print bg-white p-4 rounded-lg shadow-md mb-6 w-full max-w-4xl flex flex-wrap justify-between items-center gap-4 sticky top-4 z-50">
        <div>
            <h2 class="text-xl font-bold text-gray-800">Ambulance Bill Editor (Half Page)</h2>
            <p class="text-sm text-gray-500">Click any text to edit. Prints as half an A4 sheet.</p>
        </div>
        <div class="flex gap-3">
            <button onclick="addRow()" class="px-4 py-2 bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-md font-medium transition">
                + Add Item Row
            </button>
            <button onclick="generatePDF()" class="px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-md font-medium shadow-sm transition flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                Download PDF
            </button>
        </div>
    </div>

    <!-- Bill Canvas -->
    <div id="invoice-canvas" class="half-a4-paper text-black">
        
        <!-- Header Section -->
        <div class="text-center mb-3">
            <h1 class="text-2xl font-bold tracking-wide" contenteditable="true">Priya Ambulance services</h1>
            <div class="mt-1 text-[14px] leading-snug">
                <div contenteditable="true">37, Kathir complex, Anusham Theatre east</div>
                <div contenteditable="true">Udumalpet - 642 126</div>
                <div>Cell : <span contenteditable="true">9443472989, 7604806685</span></div>
                <div>Ph : <span contenteditable="true">04252 - 222115</span></div>
            </div>
        </div>

        <hr class="border-t border-black mb-3">

        <!-- Details Section -->
        <div class="flex justify-between text-[14px] mb-3 gap-4">
            <!-- Left Column -->
            <div class="flex flex-col gap-2 flex-1">
                <div>To</div>
                <div>Patient name : <span contenteditable="true" class="font-medium">Mr.V.Varatharaj</span></div>
                <div>Vehicle no : <span contenteditable="true">TN 09 CC 4551</span></div>
                <div>Type of Vehicle : <span contenteditable="true">Ambulance (OMNI)</span></div>
                <div>Bill no : <span id="bill-no" contenteditable="true">4856</span></div>
            </div>
            
            <!-- Right Column -->
            <div class="flex flex-col gap-2 text-right">
                <div>Date : <span contenteditable="true">08.08.2025</span></div>
                <div>Age : <span contenteditable="true">54 / M</span></div>
                <div class="mt-auto">Cash/Credit : <span contenteditable="true">Cash bill</span></div>
            </div>
        </div>

        <!-- Table Section -->
        <table class="bill-table text-[14px]" id="itemsTable">
            <thead>
                <tr>
                    <th class="font-normal text-left pl-2">S.No</th>
                    <th class="font-normal text-left pl-2">Particulars</th>
                    <th class="font-normal text-center">Amount</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr class="main-row group">
                    <td class="text-center pt-2">
                        <span contenteditable="true" class="sno">1</span>
                    </td>
                    <td class="pt-2 pl-2 flex flex-col justify-between h-full">
                        <div>
                            <span contenteditable="true" class="w-full block">SV Puram ( UDT ) To Ganga Hospital ( CBE )</span>
                        </div>
                        <div class="text-[12px] text-gray-700 mt-auto pb-1">
                            <span contenteditable="true">Rent inclusive of all expenses</span>
                        </div>
                    </td>
                    <td class="text-right pt-2 pr-2 relative">
                        <span contenteditable="true" class="amount" onkeyup="calculateTotal()">4200.00</span>
                        <!-- Delete row button (hidden on print) -->
                        <button onclick="removeRow(this)" class="no-print absolute -right-8 top-2 text-red-500 hover:text-red-700 hidden group-hover:block" title="Remove Row">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Total Section with Amount in Words -->
        <div class="flex flex-col items-end mt-2 pr-2">
            <div class="text-lg font-bold tracking-wide">
                Total amount <span id="finalTotal">4200.0</span>
            </div>
            <!-- Auto generated words display -->
            <div class="text-[12px] font-medium mt-1 text-gray-800 italic" id="amountInWords">
                Rupees Four Thousand Two Hundred Only
            </div>
        </div>

        <!-- Footer / Signatory Wrapper to push to bottom if needed -->
        <div class="mt-auto pt-4">
            <!-- Signatory Section -->
            <div class="flex justify-end">
                <div class="text-right text-[14px]">
                    <div class="mb-6">For</div>
                    <div contenteditable="true">Priya Ambulance services</div>
                </div>
            </div>

            <!-- Footer Section -->
            <div class="mt-6 text-center text-[13px]">
                <div class="mb-1">Thank you</div>
                <div class="text-[11px] uppercase tracking-wide" contenteditable="true">INDICA, OMNI, INNOVA AND ALL TYPES OF VECHILES AVAILABLE FOR TOUR & TRAVELS</div>
                <div class="text-[11px] mt-0.5" contenteditable="true">( A UNIT OF UDUMALAI DIAGNOSTICES & X RAYS )</div>
            </div>
        </div>

    </div>

    <script>
        // Number to words converter (Indian Numbering System)
        function numberToWords(amount) {
            if (isNaN(amount) || amount === 0) return "Rupees Zero Only";

            const a = ['', 'One ', 'Two ', 'Three ', 'Four ', 'Five ', 'Six ', 'Seven ', 'Eight ', 'Nine ', 'Ten ', 'Eleven ', 'Twelve ', 'Thirteen ', 'Fourteen ', 'Fifteen ', 'Sixteen ', 'Seventeen ', 'Eighteen ', 'Nineteen '];
            const b = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

            function convertWholeNumber(n) {
                if (n < 20) return a[n];
                if (n < 100) return b[Math.floor(n / 10)] + (n % 10 !== 0 ? ' ' + a[n % 10] : ' ');
                if (n < 1000) return a[Math.floor(n / 100)] + 'Hundred ' + (n % 100 !== 0 ? 'and ' + convertWholeNumber(n % 100) : '');
                if (n < 100000) return convertWholeNumber(Math.floor(n / 1000)) + 'Thousand ' + (n % 1000 !== 0 ? convertWholeNumber(n % 1000) : '');
                if (n < 10000000) return convertWholeNumber(Math.floor(n / 100000)) + 'Lakh ' + (n % 100000 !== 0 ? convertWholeNumber(n % 100000) : '');
                return convertWholeNumber(Math.floor(n / 10000000)) + 'Crore ' + (n % 10000000 !== 0 ? convertWholeNumber(n % 10000000) : '');
            }

            let numStr = parseFloat(amount).toFixed(2);
            let parts = numStr.split('.');
            let rupees = parseInt(parts[0]);
            let paise = parseInt(parts[1]);

            let res = '';
            if (rupees > 0) {
                res += 'Rupees ' + convertWholeNumber(rupees);
            } else {
                res += 'Rupees Zero ';
            }

            if (paise > 0) {
                res += 'and ' + convertWholeNumber(paise) + 'Paise ';
            }
            
            res += 'Only';
            return res.replace(/\s+/g, ' ').trim();
        }

        // Function to calculate the total sum of all amounts
        function calculateTotal() {
            let total = 0;
            const amounts = document.querySelectorAll('.amount');
            amounts.forEach(el => {
                let val = parseFloat(el.innerText);
                if (!isNaN(val)) {
                    total += val;
                }
            });
            
            // Update the number display with 1 decimal place
            document.getElementById('finalTotal').innerText = total.toFixed(1);
            
            // Update the words display
            document.getElementById('amountInWords').innerText = "(" + numberToWords(total) + ")";
        }

        // Function to add a new row
        function addRow() {
            const tbody = document.getElementById('tableBody');
            const rowCount = tbody.children.length + 1;
            
            // Remove 'main-row' class from previous rows so only the first row is tall
            Array.from(tbody.children).forEach(row => {
                row.classList.remove('main-row');
                row.cells[1].style.height = 'auto'; 
                row.cells[1].classList.remove('flex', 'flex-col', 'justify-between', 'h-full');
            });

            const tr = document.createElement('tr');
            tr.className = 'group';
            tr.innerHTML = `
                <td class="text-center py-2">
                    <span contenteditable="true" class="sno">${rowCount}</span>
                </td>
                <td class="py-2 pl-2">
                    <span contenteditable="true" class="w-full block">New Particulars Description</span>
                </td>
                <td class="text-right py-2 pr-2 relative">
                    <span contenteditable="true" class="amount" onkeyup="calculateTotal()">0.00</span>
                    <button onclick="removeRow(this)" class="no-print absolute -right-8 top-2 text-red-500 hover:text-red-700 hidden group-hover:block" title="Remove Row">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
            calculateTotal();
            reindexRows();
        }

        // Function to remove a row
        function removeRow(btn) {
            const row = btn.closest('tr');
            const tbody = document.getElementById('tableBody');
            if(tbody.children.length > 1) {
                row.remove();
                calculateTotal();
                reindexRows();
            } else {
                alert("You must have at least one item row.");
            }
        }

        // Re-index serial numbers when row is removed
        function reindexRows() {
            const snos = document.querySelectorAll('.sno');
            snos.forEach((el, index) => {
                el.innerText = index + 1;
            });
        }

        // Function to handle PDF generation
        function generatePDF() {
            const element = document.getElementById('invoice-canvas');
            
            // Get Bill number safely
            const billNoElement = document.getElementById('bill-no');
            const billNo = billNoElement ? billNoElement.innerText.trim() : 'Draft';
            const fileName = `Ambulance_Bill_${billNo}.pdf`;
            
            // Temporarily add pdf-mode class to strip UI elements and highlights
            element.classList.add('pdf-mode');

            // Set PDF options for Half A4 (A5 Landscape)
            const opt = {
                margin:       [0, 0, 0, 0], 
                filename:     fileName,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true, letterRendering: true },
                jsPDF:        { unit: 'mm', format: 'a5', orientation: 'landscape' }
            };

            // Generate and save
            html2pdf().set(opt).from(element).save().then(() => {
                // Restore UI after download starts
                element.classList.remove('pdf-mode');
            }).catch(err => {
                console.error('PDF generation error:', err);
                element.classList.remove('pdf-mode');
            });
        }

        // Initial calculation to set the total and words correctly
        calculateTotal();
    </script>
</body>
</html>


    
